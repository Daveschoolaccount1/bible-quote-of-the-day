<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Daily Bible Verse</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(to bottom, #fff8e1, #ffecb3);
      color: #4e342e;
      text-align: center;
      padding: 40px;
    }
    .verse {
      font-size: 1.8em;
      font-style: italic;
      max-width: 800px;
      margin: auto;
      background: rgba(255, 255, 255, 0.85);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .reference {
      margin-top: 15px;
      font-size: 1.2em;
      font-weight: bold;
    }
    .timestamp {
      margin-top: 20px;
      font-size: 0.9em;
      color: #6d4c41;
    }
    button {
      margin-top: 25px;
      padding: 12px 20px;
      font-size: 1em;
      border: none;
      background: #ffca28;
      color: #4e342e;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.3s;
    }
    button:hover {
      background: #ffc107;
    }
  </style>
</head>
<body>
  <div class="verse" id="verse">Loading...</div>
  <div class="reference" id="reference"></div>
  <div class="timestamp" id="timestamp"></div>
  <button onclick="getVerse()">Get Another Verse</button>

  <script>
    async function getVerse() {
      try {
        const response = await fetch('https://beta.ourmanna.com/api/v1/get/?format=json&order=random');
        const data = await response.json();
        let text = data.verse.details.text.trim();
        let ref = data.verse.details.reference.trim();

        // Filtering
        const lower = text.toLowerCase();
        const badPatterns = [
          /son of [a-z]+/i,          // genealogy
          /\b[0-9]+\s*cubits?\b/i,  // measurements
          /king\s+[a-z]+/i           // kings lists
        ];

        if (badPatterns.some(pattern => pattern.test(lower))) {
          return getVerse(); // Try again if it matches a bad pattern
        }

        document.getElementById('verse').innerText = "${text}";
        document.getElementById('reference').innerText = ${ref} (NIV);

        // WIB timestamp
        const now = new Date();
        const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', day: 'numeric', month: 'short', year: 'numeric', timeZone: 'Asia/Jakarta' };
        document.getElementById('timestamp').innerText =
          Last updated: ${now.toLocaleString('en-US', options)} WIB;

      } catch (error) {
        document.getElementById('verse').innerText = "Error fetching verse.";
        document.getElementById('reference').innerText = "";
      }
    }

    getVerse();
  </script>
</body>
</html>
